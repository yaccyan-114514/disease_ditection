<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper
        PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
        "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.disease.mapper.QuestionMapper">

    <resultMap id="questionResult" type="Question">
        <id column="id" property="id"/>
        <result column="user_id" property="userId"/>
        <result column="crop_id" property="cropId"/>
        <result column="question_text" property="questionText"/>
        <result column="images" property="images"/>
        <result column="status" property="status"/>
        <result column="created_at" property="createdAt"/>
    </resultMap>

    <insert id="insertQuestion" parameterType="Question" useGeneratedKeys="true" keyProperty="id">
        INSERT INTO questions (user_id, crop_id, question_text, images, status, created_at)
        VALUES (#{userId}, #{cropId}, #{questionText}, #{images}, #{status}, NOW())
    </insert>

    <select id="findLatest" parameterType="int" resultMap="questionResult">
        SELECT * FROM questions ORDER BY created_at DESC LIMIT #{limit}
    </select>

    <select id="findByExpertId" parameterType="long" resultMap="questionResult">
        SELECT DISTINCT q.*
        FROM questions q
        INNER JOIN answers a ON q.id = a.question_id
        WHERE a.expert_id = #{expertId}
        ORDER BY q.created_at DESC
    </select>

    <select id="findByUserId" parameterType="long" resultMap="questionResult">
        SELECT * FROM questions WHERE user_id = #{userId} ORDER BY created_at DESC
    </select>

    <select id="findById" parameterType="long" resultMap="questionResult">
        SELECT * FROM questions WHERE id = #{id}
    </select>
</mapper>

